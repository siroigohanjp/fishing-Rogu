<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³ æ‹¡å¼µç‰ˆ+</title>
<style>
  :root{
    --bg:#0b1220;--panel:#0f1724;--accent:#f59e0b;
    --muted:#94a3b8;--glass:rgba(255,255,255,0.03);
    --win:rgba(6,182,212,0.35);
  }
  html,body{margin:0;height:100%;font-family:"Segoe UI","Noto Sans JP",sans-serif;
    background:linear-gradient(180deg,#071026,#08122a);color:#e6eef8}
  .wrap{max-width:980px;margin:24px auto;padding:20px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  h1{font-size:20px;margin:0}
  .btn{background:var(--accent);border:none;color:#071026;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}
  .hud{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
  .panel{background:var(--glass);padding:10px;border-radius:10px;min-width:120px;text-align:center}
  .balance{font-size:20px;font-weight:800}
  .top-controls{display:flex;gap:10px;justify-content:center;margin-bottom:10px}
  .spin-btn{font-size:16px;padding:12px 18px;border-radius:12px;border:none;background:#06b6d4;color:#031021;font-weight:800;cursor:pointer}
  .countdown{font-size:13px;color:var(--muted);text-align:center;margin-top:-4px}
  .area{display:flex;gap:20px;margin-top:10px}
  .reel-area{flex:1;display:flex;flex-direction:column;align-items:center;gap:6px}
  .row{display:flex;gap:10px;justify-content:center}
  .reel{width:100px;height:100px;border-radius:14px;background:linear-gradient(180deg,#0f1724,#071224);
    display:flex;align-items:center;justify-content:center;font-size:44px;
    box-shadow:inset 0 -6px 20px rgba(0,0,0,0.5);position:relative;transition:background 0.3s}
  .win{background:linear-gradient(180deg,#08303a,#09505a)}
  .side{width:240px;display:flex;flex-direction:column;gap:12px}
  .panel-side{background:var(--glass);padding:10px;border-radius:10px}
  .panel-side h3{font-size:15px;margin:0 0 6px}
  .skill{margin-bottom:8px;font-size:14px;display:flex;flex-direction:column;gap:2px}
  .skill button{font-size:12px;padding:4px 8px;border-radius:8px;border:none;background:var(--accent);color:#071026;font-weight:700;cursor:pointer;width:fit-content}
  .skill small{color:var(--muted)}
  .log{background:var(--glass);padding:10px;border-radius:10px;max-height:260px;overflow:auto;font-size:13px;line-height:1.4}
  .log div{margin-bottom:4px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>ã‚¹ãƒ­ãƒƒãƒˆãƒã‚·ãƒ³ æ‹¡å¼µç‰ˆ+</h1>
    <button id="resetBtn" class="ghost">åˆæœŸåŒ–</button>
  </header>

  <div class="top-controls">
    <button id="spinBtn" class="spin-btn">ğŸ° ã‚¹ãƒ”ãƒ³</button>
    <button id="autoBtn" class="ghost">è‡ªå‹•ã‚¹ãƒ”ãƒ³ OFF</button>
  </div>
  <div class="countdown">ãƒªã‚­ãƒ£ã‚¹ãƒˆ: <span id="autoCountdown">0.0</span> ç§’</div>

  <div class="hud">
    <div class="panel"><div class="small">æ‰€æŒé‡‘</div><div id="balance" class="balance">0</div></div>
    <div class="panel"><div class="small">ãƒ—ãƒ¬ã‚¤å›æ•°</div><div id="plays">0</div></div>
    <div class="panel"><div class="small">æœ€é«˜æ‰€æŒé‡‘</div><div id="bestBalance">0</div></div>
    <div class="panel"><div class="small">æœ€å¤§é…å½“</div><div id="bestPayout">0</div></div>
  </div>

  <div class="area">
    <!-- å·¦ï¼šãƒ­ã‚° -->
    <div class="side">
      <div class="panel-side">
        <h3>ã‚¹ãƒ”ãƒ³ãƒ­ã‚°</h3>
        <div id="log" class="log"></div>
      </div>
    </div>

    <!-- ä¸­å¤®ï¼šã‚¹ãƒ­ãƒƒãƒˆ -->
    <div class="reel-area" id="reelArea"></div>

    <!-- å³ï¼šé…å½“ + ã‚¹ã‚­ãƒ« -->
    <div class="side">
      <div class="panel-side">
        <h3>é…å½“ä¸€è¦§</h3>
        <div>ğŸ’ Ã—3=5 / Ã—2=1</div>
        <div>ğŸŠ Ã—3=7 / Ã—2=1</div>
        <div>ğŸ‹ Ã—3=8 / Ã—2=1</div>
        <div>â­ Ã—3=12 / Ã—2=2</div>
        <div>7ï¸âƒ£ Ã—3=25 / Ã—2=3</div>
        <div>ğŸ’ Ã—3=40 / Ã—2=5</div>
      </div>
      <div class="panel-side">
        <h3>ã‚¹ã‚­ãƒ«</h3>
        <div class="skill">
          <b>è‡ªå‹•ã‚¹ãƒ”ãƒ³ Lv.<span id="autoLv">1</span> <small>(<span id="autoTime">5.0</span>ç§’)</small></b>
          <small>æ¬¡Lvã‚³ã‚¹ãƒˆ: <span id="autoCost">10</span></small>
          <button id="autoUp">å¼·åŒ–</button>
        </div>
        <div class="skill">
          <b>ã‚¹ãƒ­ãƒƒãƒˆè¿½åŠ  Lv.<span id="slotLv">1</span></b>
          <small>æ¬¡Lvã‚³ã‚¹ãƒˆ: <span id="slotCost">20</span></small>
          <button id="slotUp">å¼·åŒ–</button>
        </div>
        <div class="skill">
          <b>å€ãƒ—ãƒƒã‚·ãƒ¥ Lv.<span id="pushLv">1</span></b>
          <small>æ¬¡Lvã‚³ã‚¹ãƒˆ: <span id="pushCost">50</span></small>
          <button id="pushUp">å¼·åŒ–</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(()=>{
  const SYMBOLS=['ğŸ’','ğŸŠ','ğŸ‹','â­','7ï¸âƒ£','ğŸ’'];
  const PAYTABLE={'ğŸ’':{three:5,two:1},'ğŸŠ':{three:7,two:1},'ğŸ‹':{three:8,two:1},'â­':{three:12,two:2},'7ï¸âƒ£':{three:25,two:3},'ğŸ’':{three:40,two:5}};
  const reelArea=document.getElementById('reelArea');
  const balanceEl=document.getElementById('balance');
  const playsEl=document.getElementById('plays');
  const bestBalanceEl=document.getElementById('bestBalance');
  const bestPayoutEl=document.getElementById('bestPayout');
  const autoLvEl=document.getElementById('autoLv');
  const slotLvEl=document.getElementById('slotLv');
  const pushLvEl=document.getElementById('pushLv');
  const autoCostEl=document.getElementById('autoCost');
  const slotCostEl=document.getElementById('slotCost');
  const pushCostEl=document.getElementById('pushCost');
  const autoBtn=document.getElementById('autoBtn');
  const countdownEl=document.getElementById('autoCountdown');
  const logEl=document.getElementById('log');
  const spinBtn=document.getElementById('spinBtn');
  const autoUp=document.getElementById('autoUp');
  const slotUp=document.getElementById('slotUp');
  const pushUp=document.getElementById('pushUp');
  const resetBtn=document.getElementById('resetBtn');
  const autoTimeEl=document.getElementById('autoTime');

  let balance=50,plays=0,bestBalance=50,bestPayout=0;
  let autoLv=1,slotLv=1,pushLv=1;
  let autoOn=false,autoTimer=null,autoCount=0;
  const baseAuto=10,baseSlot=20,basePush=50;
  const KEY='slot_v8_save';

  function save(){localStorage.setItem(KEY,JSON.stringify({balance,plays,bestBalance,bestPayout,autoLv,slotLv,pushLv}));}
  function load(){
    const d=JSON.parse(localStorage.getItem(KEY)||'{}');
    balance=d.balance??50;plays=d.plays??0;bestBalance=d.bestBalance??50;bestPayout=d.bestPayout??0;
    autoLv=d.autoLv??1;slotLv=d.slotLv??1;pushLv=d.pushLv??1;
  }

  function reset(){
    balance=50;plays=0;bestBalance=50;bestPayout=0;
    autoLv=1;slotLv=1;pushLv=1;
    stopAuto();
    save();
    buildReels();
    render();
    logEl.innerHTML='';
    addLog('ğŸ’« ã‚²ãƒ¼ãƒ ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸ');
  }

  function currentRecast(){
    return Math.max(0.1,5-(autoLv-1)*0.1);
  }

  function render(){
    balanceEl.textContent=balance;
    playsEl.textContent=plays;
    bestBalanceEl.textContent=bestBalance;
    bestPayoutEl.textContent=bestPayout;
    autoLvEl.textContent=autoLv;
    slotLvEl.textContent=slotLv;
    pushLvEl.textContent=pushLv;
    autoCostEl.textContent=baseAuto*Math.pow(2,autoLv-1);
    slotCostEl.textContent=baseSlot*Math.pow(2,slotLv-1);
    pushCostEl.textContent=basePush*Math.pow(2,pushLv-1);
    autoTimeEl.textContent=currentRecast().toFixed(1);
  }

  function buildReels(){
    reelArea.innerHTML='';
    for(let y=0;y<slotLv;y++){
      const row=document.createElement('div');
      row.className='row';
      for(let x=0;x<3;x++){
        const r=document.createElement('div');
        r.className='reel';
        const inner=document.createElement('div');
        inner.className='inner';
        inner.textContent='?';
        r.appendChild(inner);
        row.appendChild(r);
      }
      reelArea.appendChild(row);
    }
  }

  function spin(){
    if(balance<=0){autoOn && stopAuto();reset();return;}
    spinBtn.disabled=true;

    const bet = Math.pow(2, pushLv-1);
    balance -= bet;
    plays++;

    const results=[];
    const rows=reelArea.querySelectorAll('.row');
    rows.forEach((row)=>{
      const reels=row.querySelectorAll('.reel');
      reels.forEach((r)=>{
        r.classList.remove('win');
        const inner=r.querySelector('.inner');
        const sym=SYMBOLS[Math.floor(Math.random()*SYMBOLS.length)];
        inner.textContent=sym;
        results.push(sym);
      });
    });

    const totalWin=calc(results);
    const payout = totalWin * Math.pow(2, pushLv-1);
    if(payout>0){
      balance+=payout;
      if(balance>bestBalance)bestBalance=balance;
      if(payout>bestPayout)bestPayout=payout;
      addLog(`+${payout}æš ğŸ‰`);
    } else addLog(`ã¯ãšã‚Œ (-${bet}æš)`);

    if(balance<=0){addLog('ğŸ’€ æ‰€æŒé‡‘ãŒ0ã«ãªã‚Šã¾ã—ãŸã€‚åˆæœŸåŒ–ã—ã¾ã™ã€‚');stopAuto();reset();return;}
    render();save();
    spinBtn.disabled=false;
  }

  function calc(res){
    let total=0;
    const rows=reelArea.querySelectorAll('.row');
    rows.forEach((row,y)=>{
      const reels=row.querySelectorAll('.reel');
      const r=res.slice(y*3,y*3+3);
      if(r[0]===r[1]&&r[1]===r[2]){reels.forEach(e=>e.classList.add('win'));total+=PAYTABLE[r[0]].three;}
      else if(r[0]===r[1]){reels[0].classList.add('win');reels[1].classList.add('win');total+=PAYTABLE[r[0]].two||0;}
      else if(r[1]===r[2]){reels[1].classList.add('win');reels[2].classList.add('win');total+=PAYTABLE[r[1]].two||0;}
      else if(r[0]===r[2]){reels[0].classList.add('win');reels[2].classList.add('win');total+=PAYTABLE[r[0]].two||0;}
    });
    return total;
  }

  function addLog(t){
    const div=document.createElement('div');
    div.textContent=`#${plays} ${t}`;
    logEl.prepend(div);
    while(logEl.children.length>50)logEl.lastChild.remove();
  }

  function startAuto(){
    if(autoOn)return;
    autoOn=true;
    autoBtn.textContent='è‡ªå‹•ã‚¹ãƒ”ãƒ³ ON';
    autoLoop();
  }

  function stopAuto(){
    autoOn=false;
    autoBtn.textContent='è‡ªå‹•ã‚¹ãƒ”ãƒ³ OFF';
    clearTimeout(autoTimer);
  }

  function autoLoop(){
    const delay=currentRecast();
    autoCount=delay;
    const tick=()=>{
      if(!autoOn)return;
      autoCount=Math.max(0,autoCount-0.1);
      countdownEl.textContent=autoCount.toFixed(1);
      if(autoCount<=0){
        spin();
        autoCount=delay;
      }
      autoTimer=setTimeout(tick,100);
    };
    tick();
  }

  autoBtn.onclick=()=>autoOn?stopAuto():startAuto();
  autoUp.onclick=()=>{
    const cost=baseAuto*Math.pow(2,autoLv-1);
    if(balance<cost)return alert(`å¼·åŒ–ã«${cost}æšå¿…è¦ã§ã™`);
    balance-=cost;autoLv++;render();save();addLog(`è‡ªå‹•ã‚¹ãƒ”ãƒ³ Lv${autoLv} å¼·åŒ– (-${cost}æš)`);
  };
  slotUp.onclick=()=>{
    const cost=baseSlot*Math.pow(2,slotLv-1);
    if(balance<cost)return alert(`å¼·åŒ–ã«${cost}æšå¿…è¦ã§ã™`);
    balance-=cost;slotLv++;buildReels();render();save();addLog(`ã‚¹ãƒ­ãƒƒãƒˆè¿½åŠ  Lv${slotLv} å¼·åŒ– (-${cost}æš)`);
  };
  pushUp.onclick=()=>{
    const cost=basePush*Math.pow(2,pushLv-1);
    if(balance<cost)return alert(`å¼·åŒ–ã«${cost}æšå¿…è¦ã§ã™`);
    balance-=cost;pushLv++;render();save();addLog(`å€ãƒ—ãƒƒã‚·ãƒ¥ Lv${pushLv} å¼·åŒ– (-${cost}æš)`);
  };
  resetBtn.onclick=()=>{if(confirm('ã™ã¹ã¦åˆæœŸåŒ–ã—ã¾ã™ã‹ï¼Ÿ'))reset();};
  spinBtn.onclick=spin;

  load();render();buildReels();
})();
</script>
</body>
</html>
